<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢“Ø–≥–∂—Ä—ç–ª–¥ –ê–ª–¥–∞–≥–¥—Å–∞–Ω –¶–∞–≥ –¢–æ–æ—Ü–æ–æ–ª—É—É—Ä</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD_RxGFjYwvqoDIq17ZMhdLcChy0tTTrnU&libraries=places,geometry&loading=async&callback=initMap"></script>
    <style>
        body {
            font-family: 'Arial', sans-serif;
        }
        #map {
            height: 400px;
            width: 100%;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-blue-600 mb-4">–¢“Ø–≥–∂—Ä—ç–ª–¥ –ê–ª–¥–∞–≥–¥—Å–∞–Ω –¶–∞–≥ –¢–æ–æ—Ü–æ–æ–ª—É—É—Ä</h1>
                <p class="text-gray-600 text-lg">”®–¥”©—Ä –±“Ø—Ä —Ç“Ø–≥–∂—Ä—ç–ª–¥ —Ö—ç—Ä –∏—Ö —Ü–∞–≥ –∞–ª–¥–∞–∂ –±–∞–π–≥–∞–∞–≥–∞–∞ –æ–ª–∂ –º—ç–¥—ç—ç–¥, –∂–∏–ª–∏–π–Ω —Ö—ç–º–∂—ç—ç–Ω–¥ —Ö—ç—Ä –∏—Ö –±–æ–ª–æ—Ö—ã–≥ —Ö–∞—Ä–Ω–∞ —É—É</p>
            </div>

            <!-- Calculator Card -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-2xl font-semibold mb-6 text-gray-800">üöó 3 –±–∞–π—Ä—à–ª—ã–Ω –º—ç–¥—ç—ç–ª—ç–ª –æ—Ä—É—É–ª–Ω–∞ —É—É</h2>
                
                <div class="grid md:grid-cols-1 gap-6 mb-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ì—ç—Ä–∏–π–Ω —Ö–∞—è–≥</label>
                        <input type="text" id="homeAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–ì—ç—Ä–∏–π–Ω —Ö–∞—è–≥–∞–∞ –æ—Ä—É—É–ª–Ω–∞ —É—É">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–°—É—Ä–≥—É—É–ª—å/–ê–∂–ª—ã–Ω –±–∞–π—Ä 1</label>
                        <input type="text" id="schoolAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–°—É—Ä–≥—É—É–ª—å —ç—Å–≤—ç–ª –∞–∂–ª—ã–Ω –±–∞–π—Ä–Ω—ã —Ö–∞—è–≥–∞–∞ –æ—Ä—É—É–ª–Ω–∞ —É—É">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">–ê–∂–ª—ã–Ω –±–∞–π—Ä 2 (–∑–∞–∞–≤–∞–ª –±–∏—à)</label>
                        <input type="text" id="workAddress" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="–•–æ—ë—Ä –¥–∞—Ö—å –∞–∂–ª—ã–Ω –±–∞–π—Ä–Ω—ã —Ö–∞—è–≥–∞–∞ –æ—Ä—É—É–ª–Ω–∞ —É—É">
                    </div>
                </div>

                <!-- Map -->
                <div class="mb-6">
                    <h3 class="text-lg font-medium text-gray-700 mb-3">–ì–∞–∑—Ä—ã–Ω –∑—É—Ä–∞–≥ –¥—ç—ç—Ä—Ö –º–∞—Ä—à—Ä—É—Ç</h3>
                    <div id="map" class="rounded-lg border border-gray-300"></div>
                </div>

                <button onclick="calculateRealTimeLoss()" class="w-full bg-blue-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-200">
                    ‚ö° Google Maps-–∞–∞—Ä –∂–∏–Ω—Ö—ç–Ω—ç —Ü–∞–≥–∏–π–≥ —Ç–æ–æ—Ü–æ–æ–ª–æ—Ö
                </button>
            </div>

            <!-- Results -->
            <div id="results" class="hidden bg-white rounded-lg shadow-lg p-6 mb-8">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">üìä “Æ—Ä –¥“Ø–Ω</h3>
                <div id="resultsContent"></div>
            </div>

            <!-- Info Cards -->
            <div class="grid md:grid-cols-2 gap-6 mb-8">
                <div class="bg-blue-50 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-blue-800 mb-3">üìà –•—ç—Ä—Ö—ç–Ω –∞—à–∏–≥–ª–∞—Ö –≤—ç?</h3>
                    <ol class="list-decimal list-inside text-blue-700 space-y-2">
                        <li>–ì—ç—Ä –±–æ–ª–æ–Ω –∞–∂–ª—ã–Ω –±–∞–π—Ä–Ω—ã —Ö–∞—è–≥–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É</li>
                        <li>–¢“Ø–≥–∂—Ä—ç–ª–≥“Ø–π –±–æ–ª–æ–Ω —Ç“Ø–≥–∂—Ä—ç–ª—Ç—ç–π —Ü–∞–≥–∏–π–≥ –º–∏–Ω—É—Ç–∞–∞—Ä –æ—Ä—É—É–ª–Ω–∞ —É—É</li>
                        <li>–¢–æ–æ—Ü–æ–æ–ª–æ—Ö —Ç–æ–≤—á–∏–π–≥ –¥–∞—Ä–Ω–∞ —É—É</li>
                        <li>”®–¥—Ä–∏–π–Ω, —Å–∞—Ä—ã–Ω, –∂–∏–ª–∏–π–Ω –∞–ª–¥–∞–≥–¥–ª—ã–≥ —Ö–∞—Ä–Ω–∞ —É—É</li>
                    </ol>
                </div>
                
                <div class="bg-yellow-50 rounded-lg p-6">
                    <h3 class="text-xl font-semibold text-yellow-800 mb-3">üí° –ó”©–≤–ª”©–º–∂</h3>
                    <p class="text-yellow-700 mb-2">–•–∞–º–≥–∏–π–Ω —Å–∞–π–Ω “Ø—Ä –¥“Ø–Ω–≥–∏–π–Ω —Ç—É–ª–¥:</p>
                    <ul class="list-disc list-inside text-yellow-700 space-y-1">
                        <li>”®–≥–ª”©”©–Ω–∏–π —Ü–∞–≥–∏–π–Ω —Ç“Ø–≥–∂—Ä—ç–ª–∏–π–≥ —Ö–∞—Ä–≥–∞–ª–∑–∞–Ω–∞ —É—É</li>
                        <li>–û—Ä–æ–π –±—É—Ü–∞—Ö —Ü–∞–≥–∏–π–Ω —Ç“Ø–≥–∂—Ä—ç–ª–∏–π–≥ –º”©–Ω —Ç–æ–æ—Ü–æ–æ–ª–Ω–æ —É—É</li>
                        <li>”®”©—Ä –∑–∞–º—ã–Ω —Å–æ–Ω–≥–æ–ª—Ç –±–∞–π–≥–∞–∞ —ç—Å—ç—Ö–∏–π–≥ —à–∞–ª–≥–∞–Ω–∞ —É—É</li>
                    </ul>
                </div>
            </div>

            <!-- Full Stack Version Link -->
            <div class="bg-green-50 rounded-lg p-6 text-center">
                <h3 class="text-xl font-semibold text-green-800 mb-2">üöÄ –ë“Ø—Ä—ç–Ω —Ö—É–≤–∏–ª–±–∞—Ä</h3>
                <p class="text-green-700 mb-4">Database —Ö–∞–¥–≥–∞–ª–∞–ª—Ç, —Ç“Ø“Ø—Ö —Ö–∞—Ä–∞—Ö, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫ –∑—ç—Ä—ç–≥ –±“Ø—Ä—ç–Ω —Ñ—É–Ω–∫—Ü—Ç—ç–π —Ö—É–≤–∏–ª–±–∞—Ä—ã–≥ —ç–Ω–¥ “Ø–∑–Ω—ç “Ø“Ø:</p>
                <a href="https://60h5imclz937.manus.space" target="_blank" class="inline-block bg-green-600 text-white py-2 px-6 rounded-lg font-semibold hover:bg-green-700 transition duration-200">
                    –ë“Ø—Ä—ç–Ω —Ö—É–≤–∏–ª–±–∞—Ä “Ø–∑—ç—Ö
                </a>
            </div>
        </div>
    </div>

    <script>
        let map;
        let directionsService;
        let directionsRenderer;
        let autocompleteHome, autocompleteSchool, autocompleteWork;

        function initMap() {
            // Initialize map centered on Ulaanbaatar
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 11,
                center: { lat: 47.9077, lng: 106.8832 } // Ulaanbaatar coordinates
            });

            directionsService = new google.maps.DirectionsService();
            directionsRenderer = new google.maps.DirectionsRenderer({
                draggable: true,
                panel: null
            });
            directionsRenderer.setMap(map);

            // Initialize autocomplete for address inputs
            autocompleteHome = new google.maps.places.Autocomplete(
                document.getElementById('homeAddress'),
                { componentRestrictions: { country: 'mn' } }
            );
            
            autocompleteSchool = new google.maps.places.Autocomplete(
                document.getElementById('schoolAddress'),
                { componentRestrictions: { country: 'mn' } }
            );
            
            autocompleteWork = new google.maps.places.Autocomplete(
                document.getElementById('workAddress'),
                { componentRestrictions: { country: 'mn' } }
            );

            // Add listeners for address changes
            autocompleteHome.addListener('place_changed', updateRoute);
            autocompleteSchool.addListener('place_changed', updateRoute);
            autocompleteWork.addListener('place_changed', updateRoute);
        }

        function updateRoute() {
            const homeAddress = document.getElementById('homeAddress').value;
            const schoolAddress = document.getElementById('schoolAddress').value;
            const workAddress = document.getElementById('workAddress').value;

            if (homeAddress && schoolAddress) {
                calculateAndDisplayRoute(homeAddress, schoolAddress, workAddress);
            }
        }

        function calculateAndDisplayRoute(home, school, work) {
            const waypoints = [];
            let destination = school;

            if (work && work.trim() !== '') {
                waypoints.push({
                    location: school,
                    stopover: true
                });
                destination = work;
            }

            directionsService.route({
                origin: home,
                destination: destination,
                waypoints: waypoints,
                travelMode: google.maps.TravelMode.DRIVING,
                drivingOptions: {
                    departureTime: new Date(),
                    trafficModel: google.maps.TrafficModel.BEST_GUESS
                },
                avoidHighways: false,
                avoidTolls: false
            }, (response, status) => {
                if (status === 'OK') {
                    directionsRenderer.setDirections(response);
                } else {
                    console.error('Directions request failed due to ' + status);
                }
            });
        }

        async function calculateRealTimeLoss() {
            const homeAddress = document.getElementById('homeAddress').value;
            const schoolAddress = document.getElementById('schoolAddress').value;
            const workAddress = document.getElementById('workAddress').value;

            if (!homeAddress || !schoolAddress) {
                alert('–ì—ç—Ä –±–æ–ª–æ–Ω —Å—É—Ä–≥—É—É–ª—å/–∞–∂–ª—ã–Ω –±–∞–π—Ä–Ω—ã —Ö–∞—è–≥–∏–π–≥ –∑–∞–∞–≤–∞–ª –æ—Ä—É—É–ª–Ω–∞ —É—É!');
                return;
            }

            try {
                // Show loading
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('resultsContent').innerHTML = `
                    <div class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Google Maps-–∞–∞—Å –º—ç–¥—ç—ç–ª—ç–ª –∞–≤—á –±–∞–π–Ω–∞...</p>
                    </div>
                `;

                // Calculate routes with current traffic and without traffic
                const currentTrafficTime = await getRouteTime(homeAddress, schoolAddress, workAddress, true);
                const normalTime = await getRouteTime(homeAddress, schoolAddress, workAddress, false);

                const dailyLoss = Math.max(0, (currentTrafficTime - normalTime) * 2); // Round trip
                const weeklyLoss = dailyLoss * 5; // 5 working days
                const monthlyLoss = weeklyLoss * 4; // 4 weeks
                const yearlyLoss = monthlyLoss * 12; // 12 months
                
                const yearlyHours = Math.floor(yearlyLoss / 60);
                const yearlyMinutes = yearlyLoss % 60;
                
                const routes = workAddress && workAddress.trim() !== '' ? 
                    `${homeAddress} ‚Üí ${schoolAddress} ‚Üí ${workAddress}` : 
                    `${homeAddress} ‚Üî ${schoolAddress}`;

                const resultsHTML = `
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-800">–¢“Ø–≥–∂—Ä—ç–ª–≥“Ø–π —Ü–∞–≥</h4>
                                <p class="text-2xl font-bold text-green-600">${normalTime} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-red-800">–û–¥–æ–æ–≥–∏–π–Ω —Ç“Ø–≥–∂—Ä—ç–ª—Ç—ç–π —Ü–∞–≥</h4>
                                <p class="text-2xl font-bold text-red-600">${currentTrafficTime} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-orange-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-orange-800">”®–¥—Ä–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-orange-600">${dailyLoss} –º–∏–Ω—É—Ç</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-yellow-800">7 —Ö–æ–Ω–æ–≥–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-yellow-600">${weeklyLoss} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-yellow-700">${Math.floor(weeklyLoss/60)} —Ü–∞–≥ ${weeklyLoss%60} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-800">–°–∞—Ä—ã–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-purple-600">${monthlyLoss} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-purple-700">${Math.floor(monthlyLoss/60)} —Ü–∞–≥ ${monthlyLoss%60} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-red-100 p-4 rounded-lg border-2 border-red-200">
                                <h4 class="font-semibold text-red-800">üö® –ñ–∏–ª–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-3xl font-bold text-red-600">${yearlyHours} —Ü–∞–≥ ${yearlyMinutes} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-red-700">–≠–Ω—ç –Ω—å ${Math.floor(yearlyHours/24)} ”©–¥—Ä–∏–π–Ω —Ü–∞–≥—Ç–∞–π —Ç—ç–Ω—Ü—ç–Ω—ç!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detailed Metrics -->
                    <div class="mt-6 grid md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">üìè –ù–∏–π—Ç –∑–∞–π</h4>
                            <p class="text-xl font-bold text-blue-600" id="totalDistance">-</p>
                            <p class="text-sm text-blue-600">–•–æ—ë—Ä —Ç–∞–ª—ã–Ω –∑–∞–º</p>
                        </div>
                        
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-indigo-800 mb-2">üèÉ –î—É–Ω–¥–∞–∂ —Ö—É—Ä–¥</h4>
                            <p class="text-xl font-bold text-indigo-600" id="averageSpeed">-</p>
                            <p class="text-sm text-indigo-600">–¢“Ø–≥–∂—Ä—ç–ª—Ç—ç–π “Ø–µ–¥</p>
                        </div>
                        
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-teal-800 mb-2">‚õΩ –®–∞—Ç–∞—Ö—É—É–Ω –∑–∞—Ä—Ü—É—É–ª–∞–ª—Ç</h4>
                            <p class="text-xl font-bold text-teal-600" id="fuelConsumption">-</p>
                            <p class="text-sm text-teal-600">”®–¥—Ä–∏–π–Ω –∑–∞—Ä—Ü—É—É–ª–∞–ª—Ç</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid md:grid-cols-2 gap-4">
                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-amber-800 mb-2">üí∞ –®–∞—Ç–∞—Ö—É—É–Ω –∑–∞—Ä–¥–∞–ª</h4>
                            <p class="text-lg font-bold text-amber-600" id="fuelCost">-</p>
                            <p class="text-sm text-amber-600">”®–¥—Ä–∏–π–Ω –∑–∞—Ä–¥–∞–ª (3000‚ÇÆ/–ª)</p>
                        </div>
                        
                        <div class="bg-emerald-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-emerald-800 mb-2">üå± CO‚ÇÇ —è–ª–≥–∞—Ä–∞–ª</h4>
                            <p class="text-lg font-bold text-emerald-600" id="co2Emission">-</p>
                            <p class="text-sm text-emerald-600">”®–¥—Ä–∏–π–Ω —è–ª–≥–∞—Ä–∞–ª</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">üìç –ú–∞—Ä—à—Ä—É—Ç</h4>
                        <p class="text-blue-700">${routes}</p>
                        <p class="text-sm text-blue-600 mt-1">Google Maps-–∞–∞—Å –∂–∏–Ω—Ö—ç–Ω—ç –º—ç–¥—ç—ç–ª—ç–ª –∞–≤—Å–∞–Ω</p>
                        <p class="text-xs text-blue-500 mt-1">–¢–æ–æ—Ü–æ–æ–ª—Å–æ–Ω —Ü–∞–≥: ${new Date().toLocaleString('mn-MN')}</p>
                    </div>
                `;
                
                document.getElementById('resultsContent').innerHTML = resultsHTML;
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error calculating route:', error);
                document.getElementById('resultsContent').innerHTML = `
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-red-800 mb-2">–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞</h4>
                        <p class="text-red-700">–ú–∞—Ä—à—Ä—É—Ç —Ç–æ–æ—Ü–æ–æ–ª–æ—Ö–æ–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –•–∞—è–≥—É—É–¥—ã–≥ —à–∞–ª–≥–∞–∂ –¥–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>
                    </div>
                `;
            }
        }

        function getRouteTime(home, school, work, withTraffic) {
            return new Promise((resolve, reject) => {
                const waypoints = [];
                let destination = school;

                if (work && work.trim() !== '') {
                    waypoints.push({
                        location: school,
                        stopover: true
                    });
                    destination = work;
                }

                const request = {
                    origin: home,
                    destination: destination,
                    waypoints: waypoints,
                    travelMode: google.maps.TravelMode.DRIVING,
                    avoidHighways: false,
                    avoidTolls: false,
                    drivingOptions: withTraffic ? {
                        departureTime: new Date(),
                        trafficModel: google.maps.TrafficModel.BEST_GUESS
                    } : {
                        departureTime: new Date(Date.now() + 24 * 60 * 60 * 1000),
                        trafficModel: google.maps.TrafficModel.OPTIMISTIC
                    }
                };

                directionsService.route(request, (result, status) => {
                    if (status === 'OK') {
                        const route = result.routes[0];
                        let totalDistance = 0;
                        let totalDuration = 0;

                        // Calculate total distance and duration
                        route.legs.forEach(leg => {
                            totalDistance += leg.distance.value; // in meters
                            totalDuration += leg.duration.value; // in seconds
                        });

                        // Convert to appropriate units
                        const distanceKm = totalDistance / 1000; // km
                        const durationMinutes = Math.round(totalDuration / 60); // minutes
                        const averageSpeed = distanceKm / (durationMinutes / 60); // km/h

                        resolve({
                            duration: durationMinutes,
                            distance: distanceKm,
                            speed: averageSpeed,
                            route: route
                        });
                    } else {
                        reject('Error: ' + status);
                    }
                });
            });
        }

        // Calculate detailed metrics
        function calculateDetailedMetrics(routeData) {
            // Ensure routeData exists and has required properties
            if (!routeData || typeof routeData !== 'object') {
                return {
                    roundTripDistance: '0.0',
                    averageSpeed: '0.0',
                    fuelConsumption: '0.00',
                    fuelCost: 0,
                    co2Emission: '0.00'
                };
            }

            const { distance = 0, duration = 0, speed = 0 } = routeData;
            
            // Ensure all values are numbers
            const distanceKm = parseFloat(distance) || 0;
            const durationMinutes = parseFloat(duration) || 0;
            const speedKmh = parseFloat(speed) || 0;
            
            // Round trip distance
            const roundTripDistance = distanceKm * 2;
            
            // Fuel consumption (13L per 100km for Mongolia)
            const fuelConsumptionL = (roundTripDistance * 13) / 100;
            
            // Idle fuel consumption during traffic (0.6L per hour average)
            const idleFuelL = (durationMinutes / 60) * 0.6;
            
            // Total fuel consumption
            const totalFuelL = fuelConsumptionL + idleFuelL;
            
            // Fuel cost (3000 MNT per liter)
            const fuelCostMNT = totalFuelL * 3000;
            
            // CO2 emission (2.31 kg CO2 per liter of gasoline)
            const co2EmissionKg = totalFuelL * 2.31;
            
            return {
                roundTripDistance: roundTripDistance.toFixed(1),
                averageSpeed: speedKmh.toFixed(1),
                fuelConsumption: totalFuelL.toFixed(2),
                fuelCost: Math.round(fuelCostMNT),
                co2Emission: co2EmissionKg.toFixed(2)
            };
        }

        // Update calculateGoogleMapsRoute to use detailed metrics
        async function calculateGoogleMapsRoute() {
            const homeAddress = document.getElementById('homeAddress').value;
            const schoolAddress = document.getElementById('schoolAddress').value;
            const workAddress = document.getElementById('workAddress').value;

            if (!homeAddress || !schoolAddress) {
                alert('–ì—ç—Ä –±–æ–ª–æ–Ω —Å—É—Ä–≥—É—É–ª—å/–∞–∂–ª—ã–Ω –±–∞–π—Ä–Ω—ã —Ö–∞—è–≥–∏–π–≥ –æ—Ä—É—É–ª–Ω–∞ —É—É');
                return;
            }

            try {
                document.getElementById('results').classList.remove('hidden');
                document.getElementById('resultsContent').innerHTML = `
                    <div class="text-center py-8">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                        <p class="text-gray-600">Google Maps-–∞–∞—Å –º—ç–¥—ç—ç–ª—ç–ª –∞–≤—á –±–∞–π–Ω–∞...</p>
                    </div>
                `;

                // Get route data with traffic and without traffic
                const trafficRouteData = await getRouteTime(homeAddress, schoolAddress, workAddress, true);
                const normalRouteData = await getRouteTime(homeAddress, schoolAddress, workAddress, false);

                // Extract duration values correctly
                const currentTrafficTime = trafficRouteData.duration || 0;
                const normalTime = normalRouteData.duration || 0;

                // Calculate detailed metrics
                const metrics = calculateDetailedMetrics(trafficRouteData);

                const dailyLoss = Math.max(0, (currentTrafficTime - normalTime) * 2); // Round trip
                const weeklyLoss = dailyLoss * 5; // 5 working days
                const monthlyLoss = weeklyLoss * 4; // 4 weeks
                const yearlyLoss = monthlyLoss * 12; // 12 months
                
                const yearlyHours = Math.floor(yearlyLoss / 60);
                const yearlyMinutes = yearlyLoss % 60;
                
                const routes = workAddress && workAddress.trim() !== '' ? 
                    `${homeAddress} ‚Üí ${schoolAddress} ‚Üí ${workAddress}` : 
                    `${homeAddress} ‚Üî ${schoolAddress}`;

                const resultsHTML = `
                    <div class="grid md:grid-cols-2 gap-6">
                        <div class="space-y-4">
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-green-800">–¢“Ø–≥–∂—Ä—ç–ª–≥“Ø–π —Ü–∞–≥</h4>
                                <p class="text-2xl font-bold text-green-600">${normalTime} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-red-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-red-800">–û–¥–æ–æ–≥–∏–π–Ω —Ç“Ø–≥–∂—Ä—ç–ª—Ç—ç–π —Ü–∞–≥</h4>
                                <p class="text-2xl font-bold text-red-600">${currentTrafficTime} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-orange-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-orange-800">”®–¥—Ä–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-orange-600">${dailyLoss} –º–∏–Ω—É—Ç</p>
                            </div>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-yellow-800">7 —Ö–æ–Ω–æ–≥–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-yellow-600">${weeklyLoss} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-yellow-700">${Math.floor(weeklyLoss/60)} —Ü–∞–≥ ${weeklyLoss%60} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-purple-50 p-4 rounded-lg">
                                <h4 class="font-semibold text-purple-800">–°–∞—Ä—ã–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-2xl font-bold text-purple-600">${monthlyLoss} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-purple-700">${Math.floor(monthlyLoss/60)} —Ü–∞–≥ ${monthlyLoss%60} –º–∏–Ω—É—Ç</p>
                            </div>
                            
                            <div class="bg-red-100 p-4 rounded-lg border-2 border-red-200">
                                <h4 class="font-semibold text-red-800">üö® –ñ–∏–ª–∏–π–Ω –∞–ª–¥–∞–≥–¥–∞–ª</h4>
                                <p class="text-3xl font-bold text-red-600">${yearlyHours} —Ü–∞–≥ ${yearlyMinutes} –º–∏–Ω—É—Ç</p>
                                <p class="text-sm text-red-700">–≠–Ω—ç –Ω—å ${Math.floor(yearlyHours/24)} ”©–¥—Ä–∏–π–Ω —Ü–∞–≥—Ç–∞–π —Ç—ç–Ω—Ü—ç–Ω—ç!</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Detailed Metrics -->
                    <div class="mt-6 grid md:grid-cols-3 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-blue-800 mb-2">üìè –ù–∏–π—Ç –∑–∞–π</h4>
                            <p class="text-xl font-bold text-blue-600">${metrics.roundTripDistance} –∫–º</p>
                            <p class="text-sm text-blue-600">–•–æ—ë—Ä —Ç–∞–ª—ã–Ω –∑–∞–º</p>
                        </div>
                        
                        <div class="bg-indigo-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-indigo-800 mb-2">üèÉ –î—É–Ω–¥–∞–∂ —Ö—É—Ä–¥</h4>
                            <p class="text-xl font-bold text-indigo-600">${metrics.averageSpeed} –∫–º/—Ü</p>
                            <p class="text-sm text-indigo-600">–¢“Ø–≥–∂—Ä—ç–ª—Ç—ç–π “Ø–µ–¥</p>
                        </div>
                        
                        <div class="bg-teal-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-teal-800 mb-2">‚õΩ –®–∞—Ç–∞—Ö—É—É–Ω –∑–∞—Ä—Ü—É—É–ª–∞–ª—Ç</h4>
                            <p class="text-xl font-bold text-teal-600">${metrics.fuelConsumption} –ª</p>
                            <p class="text-sm text-teal-600">”®–¥—Ä–∏–π–Ω –∑–∞—Ä—Ü—É—É–ª–∞–ª—Ç</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 grid md:grid-cols-2 gap-4">
                        <div class="bg-amber-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-amber-800 mb-2">üí∞ –®–∞—Ç–∞—Ö—É—É–Ω –∑–∞—Ä–¥–∞–ª</h4>
                            <p class="text-lg font-bold text-amber-600">${metrics.fuelCost.toLocaleString()} ‚ÇÆ</p>
                            <p class="text-sm text-amber-600">”®–¥—Ä–∏–π–Ω –∑–∞—Ä–¥–∞–ª (3000‚ÇÆ/–ª)</p>
                        </div>
                        
                        <div class="bg-emerald-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-emerald-800 mb-2">üå± CO‚ÇÇ —è–ª–≥–∞—Ä–∞–ª</h4>
                            <p class="text-lg font-bold text-emerald-600">${metrics.co2Emission} –∫–≥</p>
                            <p class="text-sm text-emerald-600">”®–¥—Ä–∏–π–Ω —è–ª–≥–∞—Ä–∞–ª</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 bg-blue-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-blue-800 mb-2">üìç –ú–∞—Ä—à—Ä—É—Ç</h4>
                        <p class="text-blue-700">${routes}</p>
                        <p class="text-sm text-blue-600 mt-1">Google Maps-–∞–∞—Å –∂–∏–Ω—Ö—ç–Ω—ç –º—ç–¥—ç—ç–ª—ç–ª –∞–≤—Å–∞–Ω</p>
                        <p class="text-xs text-blue-500 mt-1">–¢–æ–æ—Ü–æ–æ–ª—Å–æ–Ω —Ü–∞–≥: ${new Date().toLocaleString('mn-MN')}</p>
                    </div>
                `;
                
                document.getElementById('resultsContent').innerHTML = resultsHTML;
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });

            } catch (error) {
                console.error('Error calculating route:', error);
                document.getElementById('resultsContent').innerHTML = `
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <h4 class="font-semibold text-red-800 mb-2">–ê–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞</h4>
                        <p class="text-red-700">–ú–∞—Ä—à—Ä—É—Ç —Ç–æ–æ—Ü–æ–æ–ª–æ—Ö–æ–¥ –∞–ª–¥–∞–∞ –≥–∞—Ä–ª–∞–∞. –•–∞—è–≥—É—É–¥—ã–≥ —à–∞–ª–≥–∞–∂ –¥–∞—Ö–∏–Ω –æ—Ä–æ–ª–¥–æ–Ω–æ —É—É.</p>
                        <p class="text-xs text-red-600 mt-2">–ê–ª–¥–∞–∞: ${error.message}</p>
                    </div>
                `;
            }
        }

        // Legacy function for backward compatibility
        function calculateTimeLoss() {
            alert('Google Maps API –∞—à–∏–≥–ª–∞–Ω –∂–∏–Ω—Ö—ç–Ω—ç —Ç–æ–æ—Ü–æ–æ–ª–æ–ª —Ö–∏–π—Ö —Ç–æ–≤—á–∏–π–≥ –∞—à–∏–≥–ª–∞–Ω–∞ —É—É!');
        }
    </script>
</body>
</html>

